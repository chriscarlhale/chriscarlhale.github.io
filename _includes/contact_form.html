<form onsubmit="submitForm(event);" method="POST" name="sentMessage" id="contactForm" novalidate>
    <input type="hidden"  name="_subject" value="{{ site.url }} Contact Form">
    <input type="hidden" name="_recipient" value="{{ site.form_email_recipient }}">
    <input type="hidden" name="_domain" value="{{ site.url | append: site.baseurl | absolute_url }}">
    <input type="text" name="_gotcha" style="display:none" />  
    
    <input type="text" name="_gotcha" style="display:none" />    
    <div class="row control-group">
        <div class="form-group col-xs-12 floating-label-form-group controls">
        <label for="name">Name</label>
        <input type="text" name="name" class="form-control" placeholder="Name" id="name" required data-validation-required-message="Please enter your name.">
        <p class="help-block text-danger"></p>
        </div>
    </div>
    <div class="row control-group">
        <div class="form-group col-xs-12 floating-label-form-group controls">
            <label for="email">Email Address</label>
            <input type="email" name="email" class="form-control" placeholder="Email Address" id="_replyTo" required data-validation-required-message="Please enter your email address.">
            <p class="help-block text-danger"></p>
        </div>
    </div>
    <div class="row control-group">
        <div class="form-group col-xs-12 floating-label-form-group controls">
        <label for="phone">Phone Number</label>
        <input type="tel" name="phone" class="form-control" placeholder="123-456-7890" id="phone" required data-validation-required-message="Please enter a valid phone number.">
        <p class="help-block text-danger"></p>
        </div>
    </div>
    <div class="row control-group">
        <div class="form-group col-xs-12 floating-label-form-group controls">
            <label for="message">Your Inquiry</label>
            <textarea rows="3" name="message" class="form-control" placeholder="Your questions or comments" id="question" required data-validation-required-message="Please enter a question or issue."></textarea>
            <p class="help-block text-danger"></p>
        </div>
    </div>
    <br>
    <div id="success"></div>
    <div class="row">
        <div class="form-group col-xs-12">
            <button type="submit" class="btn btn-success btn-lg" onclick="submitForm(e)">Send</button>
        </div>
    </div>
</form>


<script type="text/javascript">
  function submitForm(e) {
    e.preventDefault();
    console.log("Preparing to submit form");
    
    document.sentMessage.action = "{{ site.send_email_cloud_function_url }}";
    
    console.log("Submitting form");
    
    // Submit form via fetch to avoid page reload
    const formData = new FormData(document.sentMessage);
    fetch(document.sentMessage.action, {
      method: 'POST',
      body: formData
    })
    .then(response => {
      if (!response.status == 200) {
        console.error("Network response Was an Error");
     }
      console.log("Form submitted successfully");
      // Redirect to thank you page
      window.location.href = "{{ site.url | append: site.baseurl | append: '/thank-you' | absolute_url }}";
    })
    .catch(error => {
      console.error("Error submitting form:", error);
      alert("There was an error sending your message. Please try again.");
      window.location.href = "{{ site.url | append: site.baseurl | append: '/contact-error' | absolute_url }}";
    });
  }
</script>